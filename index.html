<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sister Birthday Love Story</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #fdf6f9 0%, #ffb3d9 25%, #f0e6ff 50%, #d1f2eb 75%, #fdf6f9 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            overflow-x: hidden;
            min-height: 100vh;
            font-family: "Segoe UI", sans-serif;
            position: relative;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            position: relative;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Dialogue at top */
        #dialogue {
            position: fixed;
            top: 5%;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(1.2rem, 4vw, 2.2rem);
            font-weight: 600;
            opacity: 0;
            color: #333;
            background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(255,240,245,0.95));
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 90%;
            border: 2px solid rgba(255,192,203,0.5);
            z-index: 100;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        /* Characters in middle */
        .characters-container {
            position: fixed;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5%;
            z-index: 50;
        }
        
        .character {
            position: relative;
        }
        
        .character img {
            width: clamp(120px, 25vw, 200px);
            height: clamp(150px, 30vw, 250px);
            object-fit: cover;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 3px solid rgba(255,255,255,0.8);
            display: block;
            background: #ffccdd;
        }
        
        /* Effects in center */
        #effects {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 75;
        }
        
        .effect-item {
            position: absolute;
            font-size: clamp(2rem, 5vw, 3rem);
            opacity: 0;
        }
        
        /* Caption at bottom */
        #caption {
            position: fixed;
            bottom: 8%;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(1.1rem, 3.5vw, 2rem);
            color: #d6336c;
            font-weight: bold;
            opacity: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            text-align: center;
            background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(255,240,245,0.9));
            padding: 12px 20px;
            border-radius: 15px;
            border: 2px solid rgba(214, 51, 108, 0.3);
            box-shadow: 0 8px 20px rgba(214, 51, 108, 0.2);
            max-width: 90%;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        /* Effects and animations */
        .screen-shake {
            animation: shake 1s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-8px); }
            20% { transform: translateX(8px); }
            30% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            50% { transform: translateX(-4px); }
            60% { transform: translateX(4px); }
            70% { transform: translateX(-2px); }
            80% { transform: translateX(2px); }
        }
        
        .text-shake {
            animation: textShake 0.8s ease-in-out infinite;
        }
        
        @keyframes textShake {
            0%, 100% { transform: translate(0); }
            25% { transform: translate(-3px, -2px); }
            50% { transform: translate(3px, 2px); }
            75% { transform: translate(-2px, 3px); }
        }
        
        .red-text {
            color: #ff3333 !important;
            text-shadow: 0 0 15px rgba(255, 51, 51, 0.7) !important;
        }
        
        .rainbow-text {
            background: linear-gradient(45deg, #9c6bff, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #fab1a0);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbow 2s ease-in-out infinite;
        }
        
        @keyframes rainbow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .thinking-dots {
            display: inline-block;
        }
        
        .thinking-dots span {
            display: inline-block;
            animation: bounce 1.6s ease-in-out infinite both;
        }
        
        .thinking-dots span:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dots span:nth-child(2) { animation-delay: -0.16s; }
        .thinking-dots span:nth-child(3) { animation-delay: 0s; }
        
        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0) rotate(0deg);
            }
            40% {
                transform: scale(1.2) rotate(180deg);
            }
        }
        
        .birthday-sparkle {
            position: absolute;
            pointer-events: none;
            z-index: 1;
            font-size: clamp(1rem, 2vw, 1.5rem);
        }
        
        /* Mobile specific adjustments */
        @media (max-width: 768px) {
            #dialogue {
                top: 8%;
                font-size: clamp(1rem, 4vw, 1.4rem);
                padding: 12px 20px;
            }
            
            .characters-container {
                padding: 0 3%;
            }
            
            .character img {
                width: clamp(100px, 22vw, 160px);
                height: clamp(130px, 28vw, 200px);
            }
            
            #caption {
                bottom: 12%;
                font-size: clamp(1rem, 3.2vw, 1.4rem);
                padding: 10px 16px;
            }
            
            .effect-item {
                font-size: clamp(1.5rem, 4vw, 2.5rem);
            }
        }
        
        @media (max-width: 480px) {
            #dialogue {
                top: 10%;
                max-width: 95%;
            }
            
            .characters-container {
                padding: 0 2%;
            }
            
            #caption {
                bottom: 15%;
                max-width: 95%;
            }
        }
        
        /* Landscape mobile */
        @media (max-height: 600px) and (orientation: landscape) {
            #dialogue {
                top: 3%;
                font-size: clamp(0.9rem, 3vw, 1.2rem);
            }
            
            .characters-container {
                top: 45%;
            }
            
            .character img {
                width: clamp(80px, 18vw, 140px);
                height: clamp(100px, 22vw, 170px);
            }
            
            #caption {
                bottom: 5%;
                font-size: clamp(0.9rem, 2.8vw, 1.2rem);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Birthday sparkles background -->
        <div id="birthday-sparkles"></div>
        
        <!-- Dialogue at top -->
        <div id="dialogue"></div>
        
        <!-- Characters in middle -->
        <div class="characters-container">
            <div id="sis" class="character">
                <img id="sis-img" src="sis_asking.png" alt="Sister" onerror="this.style.background='#ffccdd'; this.innerHTML='SIS'; this.style.display='flex'; this.style.alignItems='center'; this.style.justifyContent='center'; this.style.color='#333'; this.style.fontWeight='bold';" />
            </div>
            
            <div id="me" class="character">
                <img id="me-img" src="me_thinking2.png" alt="Me" onerror="this.style.background='#ccddff'; this.innerHTML='ME'; this.style.display='flex'; this.style.alignItems='center'; this.style.justifyContent='center'; this.style.color='#333'; this.style.fontWeight='bold';" />
            </div>
        </div>
        
        <!-- Effects in center -->
        <div id="effects"></div>
        
        <!-- Caption at bottom -->
        <div id="caption"></div>
    </div>

    <script>
        let tl = gsap.timeline();
        
        // Enhanced scenes with speaker identification
        const scenes = [
            {
                sisImg: "2.jpeg",
                meImg: "me_thinking.png",
                dialogue: "How much do you love me? ‚ù§Ô∏è",
                caption: "Uh oh... the annual quiz ü§î",
                effect: "screenShake",
                duration: 4,
                speaker: "sis"
            },
            {
                sisImg: "sis_asking2.png", 
                meImg: "me_thinking2.png",
                dialogue: "Come on, just tell me! ü•∫",
                caption: "Hmm... let me think...",
                effect: "thinkingDots",
                duration: 6,
                speaker: "sis"
            },
            {
                sisImg: "sis_pouting.png",
                meImg: "me_smirking.png", 
                dialogue: "I'm waiting... ‚è∞",
                caption: "I don't love you tbh ü§∑‚Äç‚ôÇÔ∏è",
                effect: "clockTicking",
                duration: 4,
                speaker: "sis"
            },
            {
                sisImg: "sis_shocked.png",
                meImg: "me_grinning.png",
                dialogue: "EXCUSE ME?!! üò±",
                caption: "Yeah, I said it üòé",
                effect: "heartBreak",
                duration: 4,
                speaker: "sis"
            },
            {
                sisImg: "sis_angry.png",
                meImg: "me_smirking.png",
                dialogue: "ARE YOU SERIOUS?!! üò°üî•",
                caption: "Wait... let me explain! üòÖ",
                effect: "angryShake",
                duration: 5,
                speaker: "sis"
            },
            {
                sisImg: "sis_angry.png",
                meImg: "me_playful.png",
                dialogue: "This better be good... üò§",
                caption: "I can't love you because...",
                effect: "suspense",
                duration: 5,
                speaker: "sis"
            },
            {
                sisImg: "sis_pouting.png",
                meImg: "me_grinning.png",
                dialogue: "Because what?! üò†",
                caption: "Because i won't just love you! üéÇ",
                effect: "birthdayHint",
                duration: 6,
                speaker: "sis"
            },
            {
                sisImg: "sis_confused.jpeg",
                meImg: "me_grinning2.jpeg",
                dialogue: "What does that mean?",
                caption: "I ADORE you! \n and Happy Happy Birthday! \n to you chinnu üéâ",
                effect: "birthdayReveal",
                duration: 7,
                speaker: "sis"
            },
            {
                sisImg: "sis_asking2.png",
                meImg: "me_grinning.png",
                dialogue: "You remembered?! ü•∫‚ú®",
                caption: "Aye... üíïHow can i forgot my little angel's birthday",
                effect: "heartPops",
                duration: 7,
                speaker: "sis"
            },
            {
                sisImg: "end.jpeg",
                meImg: "me_playful.jpeg",
                dialogue: "ü§óHEHEHE‚ù§Ô∏è",
                caption: "Happy Birthday, Jyosh! üéÇ‚ú®",
                effect: "finalCelebration",
                duration: 5,
                speaker: "sis"
            }
        ];
        
        // Create birthday sparkles background
        function createBirthdaySparkles() {
            const container = document.getElementById("birthday-sparkles");
            const sparkleEmojis = ['‚ú®', 'üåü', 'üí´', '‚≠ê', 'üéà'];
            
            for (let i = 0; i < 15; i++) {
                let sparkle = document.createElement("div");
                sparkle.className = "birthday-sparkle";
                sparkle.innerHTML = sparkleEmojis[Math.floor(Math.random() * sparkleEmojis.length)];
                sparkle.style.left = Math.random() * 100 + "%";
                sparkle.style.top = Math.random() * 100 + "%";
                container.appendChild(sparkle);
                
                gsap.to(sparkle, {
                    rotation: 360,
                    scale: 0.5 + Math.random() * 1,
                    opacity: 0.3 + Math.random() * 0.4,
                    duration: 4 + Math.random() * 4,
                    repeat: -1,
                    yoyo: true,
                    ease: "power2.inOut"
                });
                
                gsap.to(sparkle, {
                    y: -20 + Math.random() * 40,
                    x: -10 + Math.random() * 20,
                    duration: 6 + Math.random() * 4,
                    repeat: -1,
                    yoyo: true,
                    ease: "sine.inOut"
                });
            }
        }
        
        // Handle image loading with enhanced fallbacks
        // Handle image loading with enhanced fallbacks
        document.querySelectorAll('img').forEach(img => {
            img.addEventListener('error', function() {
                this.style.backgroundColor = this.id === 'sis-img' ? '#ffccdd' : '#ccddff';
                this.style.color = '#333';
                this.style.display = 'flex';
                this.style.alignItems = 'center';
                this.style.justifyContent = 'center';
                this.style.fontWeight = 'bold';
                this.style.fontSize = 'clamp(1rem, 3vw, 1.5rem)';
                this.innerHTML = this.id === 'sis-img' ? 'SISTER' : 'ME';
            });
        });
        
        // Initialize
        function startAnimation() {
            createBirthdaySparkles();
            
            // Characters enter
            tl.from("#sis", {
                x: -200, 
                opacity: 0, 
                duration: 2, 
                ease: "back.out(1.2)"
            })
            .from("#me", {
                x: 200, 
                opacity: 0, 
                duration: 2, 
                ease: "back.out(1.2)"
            }, "-=1.5");
            
            setTimeout(() => playScene(1), 3000);
        }
        
        function playScene(sceneNum) {
            if (sceneNum > scenes.length) return;
            
            const scene = scenes[sceneNum - 1];
            
            // Clear all previous styling effects - FIX FOR MISSING CAPTIONS
            const dialogue = document.getElementById("dialogue");
            dialogue.className = "";
            dialogue.style.color = "#333";
            dialogue.style.textShadow = "2px 2px 4px rgba(0,0,0,0.3)";
            
            // Update character images
            const sisImg = document.getElementById("sis-img");
            const meImg = document.getElementById("me-img");
            
            sisImg.src = scene.sisImg;
            meImg.src = scene.meImg;
            
            // Clear previous content
            gsap.set("#dialogue", {opacity: 0});
            gsap.set("#caption", {opacity: 0});
            
            // Show dialogue
            document.getElementById("dialogue").innerHTML = scene.dialogue;
            gsap.to("#dialogue", {
                opacity: 1, 
                duration: 1,
                ease: "power2.out"
            });
            
            // Trigger effect
            setTimeout(() => triggerEffect(scene.effect), 600);
            
            // Show caption
            setTimeout(() => {
                document.getElementById("caption").innerHTML = scene.caption;
                gsap.to("#caption", {
                    opacity: 1, 
                    duration: 1.2,
                    ease: "power2.out"
                });
            }, 1500);
            
            // Next scene
            setTimeout(() => playScene(sceneNum + 1), scene.duration * 1000);
        }
        
        function triggerEffect(effectType) {
            const effectsContainer = document.getElementById("effects");
            
            switch(effectType) {
                case "screenShake":
                    document.body.classList.add("screen-shake");
                    setTimeout(() => document.body.classList.remove("screen-shake"), 1000);
                    break;
                    
                case "thinkingDots":
                    const dots = document.createElement("div");
                    dots.className = "thinking-dots";
                    dots.style.cssText = `
                        position: absolute;
                        top: -60px;
                        left: 50%;
                        transform: translateX(-50%);
                        font-size: clamp(2rem, 5vw, 3.5rem);
                        color: #666;
                    `;
                    dots.innerHTML = '<span>.</span><span>.</span><span>.</span>';
                    effectsContainer.appendChild(dots);
                    
                    gsap.to(dots, {
                        opacity: 1,
                        duration: 0.8,
                        onComplete: () => {
                            setTimeout(() => {
                                gsap.to(dots, {
                                    opacity: 0,
                                    duration: 0.8,
                                    onComplete: () => dots.remove()
                                });
                            }, 2000);
                        }
                    });
                    break;
                    
                case "clockTicking":
                    const clock = document.createElement("div");
                    clock.innerHTML = "‚è∞";
                    clock.style.cssText = `
                        position: absolute;
                        top: -50px;
                        left: 50%;
                        transform: translateX(-50%);
                        font-size: clamp(2rem, 5vw, 3rem);
                    `;
                    effectsContainer.appendChild(clock);
                    
                    gsap.to(clock, {
                        opacity: 1,
                        rotation: 360,
                        duration: 1.5,
                        repeat: 1,
                        onComplete: () => clock.remove()
                    });
                    break;
                    
                case "heartBreak":
                    const brokenHeart = document.createElement("div");
                    brokenHeart.innerHTML = "üíî";
                    brokenHeart.style.cssText = `
                        position: absolute;
                        top: 0;
                        left: 50%;
                        transform: translateX(-50%);
                        font-size: clamp(2.5rem, 6vw, 4rem);
                    `;
                    effectsContainer.appendChild(brokenHeart);
                    
                    gsap.fromTo(brokenHeart, 
                        { opacity: 0, scale: 0 },
                        { 
                            opacity: 1, 
                            scale: 1.5, 
                            duration: 0.8,
                            ease: "back.out(1.5)",
                            onComplete: () => {
                                gsap.to(brokenHeart, {
                                    y: -80,
                                    opacity: 0,
                                    duration: 1.5,
                                    onComplete: () => brokenHeart.remove()
                                });
                            }
                        }
                    );
                    break;
                    
                case "angryShake":
                    const dialogue = document.getElementById("dialogue");
                    dialogue.classList.add("text-shake", "red-text");
                    setTimeout(() => {
                        dialogue.classList.remove("text-shake", "red-text");
                    }, 2500);
                    break;
                    
                case "suspense":
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            const suspenseEmoji = document.createElement("div");
                            suspenseEmoji.innerHTML = "‚ùì";
                            suspenseEmoji.style.cssText = `
                                position: absolute;
                                top: ${-40 + i * 15}px;
                                left: ${-60 + i * 40}px;
                                font-size: clamp(2rem, 4vw, 2.5rem);
                            `;
                            effectsContainer.appendChild(suspenseEmoji);
                            
                            gsap.fromTo(suspenseEmoji,
                                { opacity: 0, scale: 0 },
                                { 
                                    opacity: 1, 
                                    scale: 1.2, 
                                    duration: 0.4,
                                    onComplete: () => {
                                        gsap.to(suspenseEmoji, {
                                            opacity: 0,
                                            duration: 0.8,
                                            onComplete: () => suspenseEmoji.remove()
                                        });
                                    }
                                }
                            );
                        }, i * 200);
                    }
                    break;
                    
                case "birthdayHint":
                    const cake = document.createElement("div");
                    cake.innerHTML = "üéÇ";
                    cake.style.cssText = `
                        position: absolute;
                        top: -60px;
                        left: 50%;
                        transform: translateX(-50%);
                        font-size: clamp(3rem, 7vw, 5rem);
                    `;
                    effectsContainer.appendChild(cake);
                    
                    gsap.fromTo(cake,
                        { opacity: 0, y: 40, scale: 0 },
                        { 
                            opacity: 1, 
                            y: 0, 
                            scale: 1, 
                            duration: 1.2,
                            ease: "bounce.out",
                            onComplete: () => {
                                gsap.to(cake, {
                                    rotation: 360,
                                    duration: 2,
                                    repeat: 1,
                                    ease: "none"
                                });
                            }
                        }
                    );
                    
                    setTimeout(() => cake.remove(), 3000);
                    break;
                    
                case "birthdayReveal":
                    const dialogue2 = document.getElementById("dialogue");
                    dialogue2.classList.add("rainbow-text");
                    
                    const balloons = ['üéà', 'üéâ', 'üéä'];
                    balloons.forEach((balloon, index) => {
                        setTimeout(() => {
                            const balloonEl = document.createElement("div");
                            balloonEl.innerHTML = balloon;
                            balloonEl.style.cssText = `
                                position: absolute;
                                top: ${-60 + index * 20}px;
                                left: ${-80 + index * 60}px;
                                font-size: clamp(2rem, 5vw, 3rem);
                            `;
                            effectsContainer.appendChild(balloonEl);
                            
                            gsap.fromTo(balloonEl,
                                { opacity: 0, y: 60, scale: 0 },
                                { 
                                    opacity: 1, 
                                    y: 0, 
                                    scale: 1.2, 
                                    duration: 0.6,
                                    ease: "back.out(1.5)",
                                    onComplete: () => {
                                        gsap.to(balloonEl, {
                                            y: -15,
                                            duration: 1.5,
                                            repeat: -1,
                                            yoyo: true,
                                            ease: "sine.inOut"
                                        });
                                    }
                                }
                            );
                        }, index * 200);
                    });
                    break;
                    
                case "heartPops":
                    const heartColors = ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'];
                    heartColors.forEach((heart, index) => {
                        setTimeout(() => {
                            const heartEl = document.createElement("div");
                            heartEl.innerHTML = heart;
                            heartEl.style.cssText = `
                                position: absolute;
                                top: ${-50 + Math.sin(index) * 30}px;
                                left: ${-100 + index * 50}px;
                                font-size: clamp(2rem, 4vw, 2.5rem);
                            `;
                            effectsContainer.appendChild(heartEl);
                            
                            gsap.fromTo(heartEl,
                                { opacity: 0, scale: 0 },
                                { 
                                    opacity: 1, 
                                    scale: 1.3, 
                                    duration: 0.8,
                                    ease: "back.out(1.5)",
                                    onComplete: () => {
                                        gsap.to(heartEl, {
                                            y: -40,
                                            opacity: 0,
                                            duration: 1.5,
                                            onComplete: () => heartEl.remove()
                                        });
                                    }
                                }
                            );
                        }, index * 100);
                    });
                    break;
                    
                case "finalCelebration":
                    finalBirthdayCelebration();
                    break;
            }
        }
        
        function finalBirthdayCelebration() {
            const container = document.getElementById("effects");
            const celebrationEmojis = ['üéâ', 'üéä', '‚ú®', 'üåü', 'üéà', 'üéÇ', 'üíñ'];
            
            // Main celebration explosion
            for (let i = 0; i < 50; i++) {
                let emoji = document.createElement("div");
                emoji.innerHTML = celebrationEmojis[Math.floor(Math.random() * celebrationEmojis.length)];
                emoji.style.cssText = `
                    position: absolute;
                    font-size: clamp(1.5rem, 3vw, 2.5rem);
                    top: 0;
                    left: 0;
                `;
                container.appendChild(emoji);
                
                let angle = Math.random() * Math.PI * 2;
                let radius = 100 + Math.random() * 300;
                let finalX = Math.cos(angle) * radius;
                let finalY = Math.sin(angle) * radius;
                
                gsap.set(emoji, { x: 0, y: 0, opacity: 1, scale: 0 });
                
                gsap.to(emoji, {
                    x: finalX,
                    y: finalY,
                    scale: 1,
                    rotation: Math.random() * 720,
                    duration: 1.5 + Math.random(),
                    ease: "power2.out",
                    delay: Math.random() * 0.5
                });
                
                gsap.to(emoji, {
                    opacity: 0,
                    duration: 2,
                    delay: 2 + Math.random(),
                    onComplete: () => emoji.remove()
                });
            }
            
            // Final birthday message
            setTimeout(() => {
                const finaleMessage = document.createElement("div");
                finaleMessage.innerHTML = "üéÇ HAPPY BIRTHDAY! üéÇ";
                finaleMessage.style.cssText = `
                    position: absolute;
                    top: -100px;
                    left: 50%;
                    transform: translateX(-50%);
                    font-size: clamp(2rem, 5vw, 3rem);
                    background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    text-shadow: 0 0 20px rgba(255,255,255,0.8);
                    white-space: nowrap;
                `;
                container.appendChild(finaleMessage);
                
                gsap.fromTo(finaleMessage,
                    { opacity: 0, scale: 0 },
                    { 
                        opacity: 1, 
                        scale: 1, 
                        duration: 1.5,
                        ease: "back.out(1.5)"
                    }
                );
            }, 1000);
            
            // Continuous celebration sparkles
            setTimeout(() => {
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        let sparkle = document.createElement("div");
                        sparkle.innerHTML = "‚ú®";
                        sparkle.style.cssText = `
                            position: absolute;
                            font-size: clamp(1rem, 2vw, 1.5rem);
                            top: ${Math.random() * 200 - 100}px;
                            left: ${Math.random() * 200 - 100}px;
                        `;
                        container.appendChild(sparkle);
                        
                        gsap.fromTo(sparkle,
                            { opacity: 0, scale: 0, rotation: 0 },
                            { 
                                opacity: 1, 
                                scale: 1.5, 
                                rotation: 360,
                                duration: 2,
                                ease: "power2.out",
                                onComplete: () => {
                                    gsap.to(sparkle, {
                                        opacity: 0,
                                        y: -50,
                                        duration: 1.5,
                                        onComplete: () => sparkle.remove()
                                    });
                                }
                            }
                        );
                    }, i * 100);
                }
            }, 2000);
        }
        
        // Enhanced image loading with retry mechanism
        function enhanceImageLoading() {
            const images = document.querySelectorAll('img');
            
            images.forEach(img => {
                let retryCount = 0;
                const maxRetries = 3;
                
                function attemptLoad() {
                    img.addEventListener('error', function handler() {
                        img.removeEventListener('error', handler);
                        
                        retryCount++;
                        if (retryCount < maxRetries) {
                            // Retry loading with cache-busting
                            setTimeout(() => {
                                const originalSrc = img.src;
                                img.src = originalSrc + '?retry=' + retryCount;
                            }, 1000 * retryCount);
                        } else {
                            // Final fallback
                            img.classList.add("fallback");
                            const isSister = img.id === 'sis-img';
                            img.innerHTML = isSister ? "üë©‚Äçüíº<br>SISTER" : "üßî‚Äç‚ôÇÔ∏è<br>ME";
                            img.style.objectFit = "initial";
                            img.style.display = "flex";
                            img.style.alignItems = "center";
                            img.style.justifyContent = "center";
                            img.style.textAlign = "center";
                            img.style.lineHeight = "1.2";
                        }
                    });
                    
                    img.addEventListener('load', function() {
                        img.classList.remove("fallback");
                        img.innerHTML = "";
                        img.style.objectFit = "cover";
                    });
                }
                
                attemptLoad();
            });
        }
        
        // Auto-restart functionality
        function setupAutoRestart() {
            const totalDuration = scenes.reduce((sum, scene) => sum + scene.duration, 0) + 3; // +3 for initial animation
            
            setTimeout(() => {
                // Fade out everything
                gsap.to("body", {
                    opacity: 0,
                    duration: 2,
                    onComplete: () => {
                        // Reset everything
                        document.getElementById("effects").innerHTML = "";
                        document.getElementById("birthday-sparkles").innerHTML = "";
                        resetTextStyles();
                        clearHighlights();
                        
                        // Fade back in and restart
                        gsap.to("body", {
                            opacity: 1,
                            duration: 2,
                            onComplete: () => {
                                setTimeout(() => startAnimation(), 1000);
                            }
                        });
                    }
                });
            }, totalDuration * 1000);
        }
        
        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            enhanceImageLoading();
            startAnimation();
            setupAutoRestart();
        });
        
        // Fallback if DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            // Do nothing, event listener will handle it
        } else {
            enhanceImageLoading();
            startAnimation();
            setupAutoRestart();
        }
    </script>
</body>
</html>
                                            